syntax = "proto3";
package hostserve.v1;
option go_package = "github.com/bmj2728/HostServiceTest/shared/protogen/hostserve/v1;hostservev1";

//ENUMs

enum OpenFileMode {
  OPEN_FILE_MODE_UNSPECIFIED = 0;

  // Read modes
  READ_ONLY = 1;                    // O_RDONLY

  // Write modes
  WRITE_TRUNCATE = 2;               // O_WRONLY|O_CREATE|O_TRUNC (like os.Create)
  WRITE_APPEND = 3;                 // O_WRONLY|O_CREATE|O_APPEND
  WRITE_EXCLUSIVE = 4;              // O_WRONLY|O_CREATE|O_EXCL (fail if exists)

  // Read/Write modes
  READ_WRITE = 5;                   // O_RDWR
  READ_WRITE_CREATE = 6;            // O_RDWR|O_CREATE
  READ_WRITE_TRUNCATE = 7;          // O_RDWR|O_CREATE|O_TRUNC
  READ_WRITE_APPEND = 8;            // O_RDWR|O_CREATE|O_APPEND
}

// HostService is a service provided by the host process and is generally preferred over granting direct
// access to the plugin process
service HostService {
  //FS Endpoints

  rpc ReadDir(ReadDirRequest) returns (ReadDirResponse);
  rpc ReadFile(ReadFileRequest) returns (ReadFileResponse);
  rpc WriteFile(WriteFileRequest) returns (WriteFileResponse);

  //FS Streaming Endpoints
  rpc OpenFile(OpenFileRequest) returns (OpenFileResponse);
  rpc CloseFile(CloseFileRequest) returns (CloseFileResponse);
  rpc Read(ReadRequest) returns (ReadResponse);
  rpc Write(WriteRequest) returns (WriteResponse);

  //Env Endpoints

  rpc GetEnv(GetEnvRequest) returns (GetEnvResponse);
}

// Type Definitions

// DirEntry represents the basic dir entry data
message DirEntry {
  string name = 1;
  bool is_dir = 2;
}

message FileChunk {
  bytes data = 1;
  uint64 offset = 2;
  bool is_final = 3;
}

// FS Messages

message ReadDirRequest {
  string path = 1;
}

message ReadDirResponse {
  repeated DirEntry entries = 1;
  optional string error = 2;
}

message ReadFileRequest {
  string path = 1;
}

message ReadFileResponse {
  bytes contents = 1;
  optional string error = 2;
}

message WriteFileRequest {
  string path = 1;
  bytes data = 2;
  uint32 perm = 3;
}

message WriteFileResponse {
  optional string error = 1;
}

message OpenFileRequest {
  string path = 1;
  OpenFileMode mode = 2;
  uint32 perm = 3;
}

message OpenFileResponse {
  string handle = 1;
  uint64 size = 2;
  optional string error = 3;
}

message CloseFileRequest {
  string handle = 1;
}

message CloseFileResponse {
  optional string error = 1;
}

message ReadRequest {
  string handle = 1;
  uint32 chunk_size = 2;
}

message ReadResponse {
  FileChunk chunk = 1;
  optional string error = 2;
}

message WriteRequest {
  string handle = 1;
  FileChunk chunk = 2;
}

message WriteResponse {
  uint32 bytes_written = 1;
  optional string error = 2;
}

// Env Service Messages

message GetEnvRequest {
  string key = 1;
}

message GetEnvResponse {
  string val = 1;
}
